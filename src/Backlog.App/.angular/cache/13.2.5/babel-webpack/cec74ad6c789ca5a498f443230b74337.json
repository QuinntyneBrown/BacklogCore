{"ast":null,"code":"import { FormControl, Validators } from '@angular/forms';\nimport { Destroyable } from '@core';\nimport { AddSprintDialogComponent, FileUploadDialogComponent } from '@shared/components/dialogs';\nimport { AddDependencyRelationshipDialogComponent } from '@shared/components/dialogs/add-dependency-relationship-dialog';\nimport { AddSkillRequirementDialogComponent } from '@shared/components/dialogs/add-skill-requirement-dialog';\nimport { BehaviorSubject, combineLatest, of, Subject } from 'rxjs';\nimport { map, startWith, switchMap, takeUntil, tap } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@api\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"@angular/material/dialog\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"../../@shared/components/story-control/story-control.component\";\nimport * as i6 from \"@angular/forms\";\nimport * as i7 from \"@angular/material/checkbox\";\n\nfunction StoryComponent_ng_container_0_h1_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"h1\", 7)(1, \"span\");\n    i0.ɵɵtext(2, \"Create Story\");\n    i0.ɵɵelementEnd()();\n  }\n}\n\nfunction StoryComponent_ng_container_0_h1_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"h1\", 7)(1, \"span\");\n    i0.ɵɵtext(2, \"Edit Story\");\n    i0.ɵɵelementEnd()();\n  }\n}\n\nfunction StoryComponent_ng_container_0_mat_checkbox_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-checkbox\", 8);\n    i0.ɵɵtext(1, \" Create Another \");\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"formControl\", ctx_r4.createAnotherControl);\n  }\n}\n\nconst _c0 = function () {\n  return [\"/\", \"stories\"];\n};\n\nfunction StoryComponent_ng_container_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, StoryComponent_ng_container_0_h1_1_Template, 3, 0, \"h1\", 1);\n    i0.ɵɵtemplate(2, StoryComponent_ng_container_0_h1_2_Template, 3, 0, \"h1\", 1);\n    i0.ɵɵelementStart(3, \"bl-story-control\", 2);\n    i0.ɵɵlistener(\"addSkillRequirementClick\", function StoryComponent_ng_container_0_Template_bl_story_control_addSkillRequirementClick_3_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r6);\n      const vm_r1 = restoredCtx.ngIf;\n      const ctx_r5 = i0.ɵɵnextContext();\n      return ctx_r5.handleAddSkillRequirementClick(vm_r1.storyControl.value);\n    })(\"addDependencyRelationshipClick\", function StoryComponent_ng_container_0_Template_bl_story_control_addDependencyRelationshipClick_3_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r6);\n      const vm_r1 = restoredCtx.ngIf;\n      const ctx_r7 = i0.ɵɵnextContext();\n      return ctx_r7.handleAddDependencyRelationshipClick(vm_r1.storyControl.value);\n    })(\"fileUploadClick\", function StoryComponent_ng_container_0_Template_bl_story_control_fileUploadClick_3_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r6);\n      const vm_r1 = restoredCtx.ngIf;\n      const ctx_r8 = i0.ɵɵnextContext();\n      return ctx_r8.handleFileUploadClick(vm_r1.storyControl.value);\n    })(\"addSprint\", function StoryComponent_ng_container_0_Template_bl_story_control_addSprint_3_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r6);\n      const vm_r1 = restoredCtx.ngIf;\n      const ctx_r9 = i0.ɵɵnextContext();\n      return ctx_r9.onAddSprint(vm_r1.story.storyId);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"div\", 3);\n    i0.ɵɵtemplate(5, StoryComponent_ng_container_0_mat_checkbox_5_Template, 2, 1, \"mat-checkbox\", 4);\n    i0.ɵɵelementStart(6, \"button\", 5);\n    i0.ɵɵtext(7, \" Cancel \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"button\", 6);\n    i0.ɵɵlistener(\"click\", function StoryComponent_ng_container_0_Template_button_click_8_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r6);\n      const vm_r1 = restoredCtx.ngIf;\n      const ctx_r10 = i0.ɵɵnextContext();\n      return ctx_r10.save(vm_r1.storyControl.value);\n    });\n    i0.ɵɵtext(9, \" Save \");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const vm_r1 = ctx.ngIf;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !vm_r1.storyControl.value.storyId);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", vm_r1.storyControl.value.storyId);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"formControl\", vm_r1.storyControl)(\"sprints\", vm_r1.sprints);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", !vm_r1.storyControl.value.storyId);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction0(6, _c0));\n  }\n}\n\nexport class StoryComponent extends Destroyable {\n  constructor(_storyService, _sprintService, _activatedRoute, _router, _dialog) {\n    super();\n    this._storyService = _storyService;\n    this._sprintService = _sprintService;\n    this._activatedRoute = _activatedRoute;\n    this._router = _router;\n    this._dialog = _dialog;\n    this.createAnotherControl = new FormControl(null, []);\n    this._addSprintSubject = new Subject();\n    this._addSprint$ = this._addSprintSubject.asObservable();\n    this._refreshSubject = new BehaviorSubject(null);\n    this._refresh$ = this._refreshSubject;\n    this.vm$ = combineLatest([this._activatedRoute.paramMap, this._addSprint$.pipe(switchMap(storyId => {\n      return this._dialog.open(AddSprintDialogComponent, {\n        data: storyId\n      }).afterClosed().pipe(tap(_ => this._refreshSubject.next()));\n    }), startWith(null)), this._refresh$]).pipe(map(([paramMap]) => paramMap.get(\"storyId\")), switchMap(storyId => combineLatest([storyId ? this._storyService.getById({\n      storyId\n    }) : of({}), storyId ? this._sprintService.getByStoryId({\n      storyId\n    }) : of([])])), map(([story, sprints]) => {\n      const storyControl = new FormControl(story, [Validators.required]);\n      return {\n        story,\n        storyControl,\n        sprints\n      };\n    }));\n  }\n\n  save(story) {\n    const obs$ = story.storyId ? this._storyService.update({\n      story\n    }) : this._storyService.create({\n      story\n    });\n    obs$.pipe(takeUntil(this._destroyed$), tap(x => {\n      if (!this.createAnotherControl.value) {\n        this._router.navigate(['/', 'stories']);\n      }\n    })).subscribe();\n  }\n\n  handleAddDependencyRelationshipClick(story) {\n    this._dialog.open(AddDependencyRelationshipDialogComponent, {\n      panelClass: 'g-dialog-panel',\n      data: story\n    }).afterClosed().pipe(takeUntil(this._destroyed$)).subscribe();\n  }\n\n  handleAddSkillRequirementClick(story) {\n    this._dialog.open(AddSkillRequirementDialogComponent, {\n      panelClass: 'g-dialog-panel',\n      data: story\n    }).afterClosed().pipe(takeUntil(this._destroyed$)).subscribe();\n  }\n\n  handleFileUploadClick(story) {\n    this._dialog.open(FileUploadDialogComponent, {\n      panelClass: 'g-dialog-panel',\n      width: '100%',\n      maxWidth: '600px'\n    }).afterClosed().pipe(takeUntil(this._destroyed$)).subscribe();\n  }\n\n  onAddSprint(storyId) {\n    this._addSprintSubject.next(storyId);\n  }\n\n}\n\nStoryComponent.ɵfac = function StoryComponent_Factory(t) {\n  return new (t || StoryComponent)(i0.ɵɵdirectiveInject(i1.StoryService), i0.ɵɵdirectiveInject(i1.SprintService), i0.ɵɵdirectiveInject(i2.ActivatedRoute), i0.ɵɵdirectiveInject(i2.Router), i0.ɵɵdirectiveInject(i3.MatDialog));\n};\n\nStoryComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: StoryComponent,\n  selectors: [[\"bl-story\"]],\n  features: [i0.ɵɵInheritDefinitionFeature],\n  decls: 2,\n  vars: 3,\n  consts: [[4, \"ngIf\"], [\"class\", \"bl-title\", 4, \"ngIf\"], [3, \"formControl\", \"sprints\", \"addSkillRequirementClick\", \"addDependencyRelationshipClick\", \"fileUploadClick\", \"addSprint\"], [1, \"g-actions\"], [3, \"formControl\", 4, \"ngIf\"], [1, \"bl-button\", 3, \"routerLink\"], [1, \"bl-button\", 3, \"click\"], [1, \"bl-title\"], [3, \"formControl\"]],\n  template: function StoryComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵtemplate(0, StoryComponent_ng_container_0_Template, 10, 7, \"ng-container\", 0);\n      i0.ɵɵpipe(1, \"async\");\n    }\n\n    if (rf & 2) {\n      i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(1, 1, ctx.vm$));\n    }\n  },\n  directives: [i4.NgIf, i5.StoryControlComponent, i6.NgControlStatus, i6.FormControlDirective, i7.MatCheckbox, i2.RouterLink],\n  pipes: [i4.AsyncPipe],\n  styles: [\"[_nghost-%COMP%] {\\n  display: block;\\n  padding-top: 40px;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInN0b3J5LmNvbXBvbmVudC5zY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0VBQ0UsY0FBQTtFQUNBLGlCQUFBO0FBQ0YiLCJmaWxlIjoic3RvcnkuY29tcG9uZW50LnNjc3MiLCJzb3VyY2VzQ29udGVudCI6WyI6aG9zdCB7XHJcbiAgZGlzcGxheTogYmxvY2s7XHJcbiAgcGFkZGluZy10b3A6IDQwcHg7XHJcbn1cclxuIl19 */\"]\n});","map":{"version":3,"sources":["C:/projects/Backlog/src/Backlog.App/src/app/stories/story/story.component.ts"],"names":["FormControl","Validators","Destroyable","AddSprintDialogComponent","FileUploadDialogComponent","AddDependencyRelationshipDialogComponent","AddSkillRequirementDialogComponent","BehaviorSubject","combineLatest","of","Subject","map","startWith","switchMap","takeUntil","tap","i0","i1","i2","i3","i4","i5","i6","i7","StoryComponent_ng_container_0_h1_1_Template","rf","ctx","ɵɵelementStart","ɵɵtext","ɵɵelementEnd","StoryComponent_ng_container_0_h1_2_Template","StoryComponent_ng_container_0_mat_checkbox_5_Template","ctx_r4","ɵɵnextContext","ɵɵproperty","createAnotherControl","_c0","StoryComponent_ng_container_0_Template","_r6","ɵɵgetCurrentView","ɵɵelementContainerStart","ɵɵtemplate","ɵɵlistener","StoryComponent_ng_container_0_Template_bl_story_control_addSkillRequirementClick_3_listener","restoredCtx","ɵɵrestoreView","vm_r1","ngIf","ctx_r5","handleAddSkillRequirementClick","storyControl","value","StoryComponent_ng_container_0_Template_bl_story_control_addDependencyRelationshipClick_3_listener","ctx_r7","handleAddDependencyRelationshipClick","StoryComponent_ng_container_0_Template_bl_story_control_fileUploadClick_3_listener","ctx_r8","handleFileUploadClick","StoryComponent_ng_container_0_Template_bl_story_control_addSprint_3_listener","ctx_r9","onAddSprint","story","storyId","StoryComponent_ng_container_0_Template_button_click_8_listener","ctx_r10","save","ɵɵelementContainerEnd","ɵɵadvance","sprints","ɵɵpureFunction0","StoryComponent","constructor","_storyService","_sprintService","_activatedRoute","_router","_dialog","_addSprintSubject","_addSprint$","asObservable","_refreshSubject","_refresh$","vm$","paramMap","pipe","open","data","afterClosed","_","next","get","getById","getByStoryId","required","obs$","update","create","_destroyed$","x","navigate","subscribe","panelClass","width","maxWidth","ɵfac","StoryComponent_Factory","t","ɵɵdirectiveInject","StoryService","SprintService","ActivatedRoute","Router","MatDialog","ɵcmp","ɵɵdefineComponent","type","selectors","features","ɵɵInheritDefinitionFeature","decls","vars","consts","template","StoryComponent_Template","ɵɵpipe","ɵɵpipeBind1","directives","NgIf","StoryControlComponent","NgControlStatus","FormControlDirective","MatCheckbox","RouterLink","pipes","AsyncPipe","styles"],"mappings":"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","sourcesContent":["import { FormControl, Validators } from '@angular/forms';\r\nimport { Destroyable } from '@core';\r\nimport { AddSprintDialogComponent, FileUploadDialogComponent } from '@shared/components/dialogs';\r\nimport { AddDependencyRelationshipDialogComponent } from '@shared/components/dialogs/add-dependency-relationship-dialog';\r\nimport { AddSkillRequirementDialogComponent } from '@shared/components/dialogs/add-skill-requirement-dialog';\r\nimport { BehaviorSubject, combineLatest, of, Subject } from 'rxjs';\r\nimport { map, startWith, switchMap, takeUntil, tap } from 'rxjs/operators';\r\nimport * as i0 from \"@angular/core\";\r\nimport * as i1 from \"@api\";\r\nimport * as i2 from \"@angular/router\";\r\nimport * as i3 from \"@angular/material/dialog\";\r\nimport * as i4 from \"@angular/common\";\r\nimport * as i5 from \"../../@shared/components/story-control/story-control.component\";\r\nimport * as i6 from \"@angular/forms\";\r\nimport * as i7 from \"@angular/material/checkbox\";\r\nfunction StoryComponent_ng_container_0_h1_1_Template(rf, ctx) { if (rf & 1) {\r\n    i0.ɵɵelementStart(0, \"h1\", 7)(1, \"span\");\r\n    i0.ɵɵtext(2, \"Create Story\");\r\n    i0.ɵɵelementEnd()();\r\n} }\r\nfunction StoryComponent_ng_container_0_h1_2_Template(rf, ctx) { if (rf & 1) {\r\n    i0.ɵɵelementStart(0, \"h1\", 7)(1, \"span\");\r\n    i0.ɵɵtext(2, \"Edit Story\");\r\n    i0.ɵɵelementEnd()();\r\n} }\r\nfunction StoryComponent_ng_container_0_mat_checkbox_5_Template(rf, ctx) { if (rf & 1) {\r\n    i0.ɵɵelementStart(0, \"mat-checkbox\", 8);\r\n    i0.ɵɵtext(1, \" Create Another \");\r\n    i0.ɵɵelementEnd();\r\n} if (rf & 2) {\r\n    const ctx_r4 = i0.ɵɵnextContext(2);\r\n    i0.ɵɵproperty(\"formControl\", ctx_r4.createAnotherControl);\r\n} }\r\nconst _c0 = function () { return [\"/\", \"stories\"]; };\r\nfunction StoryComponent_ng_container_0_Template(rf, ctx) { if (rf & 1) {\r\n    const _r6 = i0.ɵɵgetCurrentView();\r\n    i0.ɵɵelementContainerStart(0);\r\n    i0.ɵɵtemplate(1, StoryComponent_ng_container_0_h1_1_Template, 3, 0, \"h1\", 1);\r\n    i0.ɵɵtemplate(2, StoryComponent_ng_container_0_h1_2_Template, 3, 0, \"h1\", 1);\r\n    i0.ɵɵelementStart(3, \"bl-story-control\", 2);\r\n    i0.ɵɵlistener(\"addSkillRequirementClick\", function StoryComponent_ng_container_0_Template_bl_story_control_addSkillRequirementClick_3_listener() { const restoredCtx = i0.ɵɵrestoreView(_r6); const vm_r1 = restoredCtx.ngIf; const ctx_r5 = i0.ɵɵnextContext(); return ctx_r5.handleAddSkillRequirementClick(vm_r1.storyControl.value); })(\"addDependencyRelationshipClick\", function StoryComponent_ng_container_0_Template_bl_story_control_addDependencyRelationshipClick_3_listener() { const restoredCtx = i0.ɵɵrestoreView(_r6); const vm_r1 = restoredCtx.ngIf; const ctx_r7 = i0.ɵɵnextContext(); return ctx_r7.handleAddDependencyRelationshipClick(vm_r1.storyControl.value); })(\"fileUploadClick\", function StoryComponent_ng_container_0_Template_bl_story_control_fileUploadClick_3_listener() { const restoredCtx = i0.ɵɵrestoreView(_r6); const vm_r1 = restoredCtx.ngIf; const ctx_r8 = i0.ɵɵnextContext(); return ctx_r8.handleFileUploadClick(vm_r1.storyControl.value); })(\"addSprint\", function StoryComponent_ng_container_0_Template_bl_story_control_addSprint_3_listener() { const restoredCtx = i0.ɵɵrestoreView(_r6); const vm_r1 = restoredCtx.ngIf; const ctx_r9 = i0.ɵɵnextContext(); return ctx_r9.onAddSprint(vm_r1.story.storyId); });\r\n    i0.ɵɵelementEnd();\r\n    i0.ɵɵelementStart(4, \"div\", 3);\r\n    i0.ɵɵtemplate(5, StoryComponent_ng_container_0_mat_checkbox_5_Template, 2, 1, \"mat-checkbox\", 4);\r\n    i0.ɵɵelementStart(6, \"button\", 5);\r\n    i0.ɵɵtext(7, \" Cancel \");\r\n    i0.ɵɵelementEnd();\r\n    i0.ɵɵelementStart(8, \"button\", 6);\r\n    i0.ɵɵlistener(\"click\", function StoryComponent_ng_container_0_Template_button_click_8_listener() { const restoredCtx = i0.ɵɵrestoreView(_r6); const vm_r1 = restoredCtx.ngIf; const ctx_r10 = i0.ɵɵnextContext(); return ctx_r10.save(vm_r1.storyControl.value); });\r\n    i0.ɵɵtext(9, \" Save \");\r\n    i0.ɵɵelementEnd()();\r\n    i0.ɵɵelementContainerEnd();\r\n} if (rf & 2) {\r\n    const vm_r1 = ctx.ngIf;\r\n    i0.ɵɵadvance(1);\r\n    i0.ɵɵproperty(\"ngIf\", !vm_r1.storyControl.value.storyId);\r\n    i0.ɵɵadvance(1);\r\n    i0.ɵɵproperty(\"ngIf\", vm_r1.storyControl.value.storyId);\r\n    i0.ɵɵadvance(1);\r\n    i0.ɵɵproperty(\"formControl\", vm_r1.storyControl)(\"sprints\", vm_r1.sprints);\r\n    i0.ɵɵadvance(2);\r\n    i0.ɵɵproperty(\"ngIf\", !vm_r1.storyControl.value.storyId);\r\n    i0.ɵɵadvance(1);\r\n    i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction0(6, _c0));\r\n} }\r\nexport class StoryComponent extends Destroyable {\r\n    constructor(_storyService, _sprintService, _activatedRoute, _router, _dialog) {\r\n        super();\r\n        this._storyService = _storyService;\r\n        this._sprintService = _sprintService;\r\n        this._activatedRoute = _activatedRoute;\r\n        this._router = _router;\r\n        this._dialog = _dialog;\r\n        this.createAnotherControl = new FormControl(null, []);\r\n        this._addSprintSubject = new Subject();\r\n        this._addSprint$ = this._addSprintSubject.asObservable();\r\n        this._refreshSubject = new BehaviorSubject(null);\r\n        this._refresh$ = this._refreshSubject;\r\n        this.vm$ = combineLatest([\r\n            this._activatedRoute.paramMap,\r\n            this._addSprint$.pipe(switchMap(storyId => {\r\n                return this._dialog\r\n                    .open(AddSprintDialogComponent, {\r\n                    data: storyId\r\n                })\r\n                    .afterClosed()\r\n                    .pipe(tap(_ => this._refreshSubject.next()));\r\n            }), startWith(null)),\r\n            this._refresh$\r\n        ])\r\n            .pipe(map(([paramMap]) => paramMap.get(\"storyId\")), switchMap(storyId => combineLatest([\r\n            storyId ? this._storyService.getById({ storyId }) : of({}),\r\n            storyId ? this._sprintService.getByStoryId({ storyId }) : of([])\r\n        ])), map(([story, sprints]) => {\r\n            const storyControl = new FormControl(story, [Validators.required]);\r\n            return {\r\n                story,\r\n                storyControl,\r\n                sprints\r\n            };\r\n        }));\r\n    }\r\n    save(story) {\r\n        const obs$ = story.storyId\r\n            ? this._storyService.update({ story })\r\n            : this._storyService.create({ story });\r\n        obs$\r\n            .pipe(takeUntil(this._destroyed$), tap(x => {\r\n            if (!this.createAnotherControl.value) {\r\n                this._router.navigate(['/', 'stories']);\r\n            }\r\n        })).subscribe();\r\n    }\r\n    handleAddDependencyRelationshipClick(story) {\r\n        this._dialog\r\n            .open(AddDependencyRelationshipDialogComponent, {\r\n            panelClass: 'g-dialog-panel',\r\n            data: story\r\n        })\r\n            .afterClosed()\r\n            .pipe(takeUntil(this._destroyed$))\r\n            .subscribe();\r\n    }\r\n    handleAddSkillRequirementClick(story) {\r\n        this._dialog\r\n            .open(AddSkillRequirementDialogComponent, {\r\n            panelClass: 'g-dialog-panel',\r\n            data: story\r\n        })\r\n            .afterClosed()\r\n            .pipe(takeUntil(this._destroyed$))\r\n            .subscribe();\r\n    }\r\n    handleFileUploadClick(story) {\r\n        this._dialog.open(FileUploadDialogComponent, {\r\n            panelClass: 'g-dialog-panel',\r\n            width: '100%',\r\n            maxWidth: '600px'\r\n        })\r\n            .afterClosed()\r\n            .pipe(takeUntil(this._destroyed$)).subscribe();\r\n    }\r\n    onAddSprint(storyId) {\r\n        this._addSprintSubject.next(storyId);\r\n    }\r\n}\r\nStoryComponent.ɵfac = function StoryComponent_Factory(t) { return new (t || StoryComponent)(i0.ɵɵdirectiveInject(i1.StoryService), i0.ɵɵdirectiveInject(i1.SprintService), i0.ɵɵdirectiveInject(i2.ActivatedRoute), i0.ɵɵdirectiveInject(i2.Router), i0.ɵɵdirectiveInject(i3.MatDialog)); };\r\nStoryComponent.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: StoryComponent, selectors: [[\"bl-story\"]], features: [i0.ɵɵInheritDefinitionFeature], decls: 2, vars: 3, consts: [[4, \"ngIf\"], [\"class\", \"bl-title\", 4, \"ngIf\"], [3, \"formControl\", \"sprints\", \"addSkillRequirementClick\", \"addDependencyRelationshipClick\", \"fileUploadClick\", \"addSprint\"], [1, \"g-actions\"], [3, \"formControl\", 4, \"ngIf\"], [1, \"bl-button\", 3, \"routerLink\"], [1, \"bl-button\", 3, \"click\"], [1, \"bl-title\"], [3, \"formControl\"]], template: function StoryComponent_Template(rf, ctx) { if (rf & 1) {\r\n        i0.ɵɵtemplate(0, StoryComponent_ng_container_0_Template, 10, 7, \"ng-container\", 0);\r\n        i0.ɵɵpipe(1, \"async\");\r\n    } if (rf & 2) {\r\n        i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(1, 1, ctx.vm$));\r\n    } }, directives: [i4.NgIf, i5.StoryControlComponent, i6.NgControlStatus, i6.FormControlDirective, i7.MatCheckbox, i2.RouterLink], pipes: [i4.AsyncPipe], styles: [\"[_nghost-%COMP%] {\\n  display: block;\\n  padding-top: 40px;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInN0b3J5LmNvbXBvbmVudC5zY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0VBQ0UsY0FBQTtFQUNBLGlCQUFBO0FBQ0YiLCJmaWxlIjoic3RvcnkuY29tcG9uZW50LnNjc3MiLCJzb3VyY2VzQ29udGVudCI6WyI6aG9zdCB7XHJcbiAgZGlzcGxheTogYmxvY2s7XHJcbiAgcGFkZGluZy10b3A6IDQwcHg7XHJcbn1cclxuIl19 */\"] });\r\n"]},"metadata":{},"sourceType":"module"}